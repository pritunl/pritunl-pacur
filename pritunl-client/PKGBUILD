targets=(
    "archlinux"
    "amazonlinux-2"
    "centos-7"
    "debian-jessie"
    "debian-stretch"
    "ubuntu-trusty"
    "ubuntu-xenial"
    "ubuntu-artful"
    "ubuntu-bionic"
)
pkgname="pritunl-client"
pkgver="1.0.1568.9"
pkgrel="1"
pkgdesc="Pritunl OpenVPN Client"
pkgdesclong=(
    "Free and open source cross platform OpenVPN client"
)
maintainer="Pritunl <contact@pritunl.com>"
arch="all"
license=("custom")
section="utils"
priority="optional"
url="https://github.com/pritunl/pritunl-client"
depends:pacman=(
    "python2"
    "python2-setuptools"
    "python2-requests"
    "python2-crypto"
    "net-tools"
    "iproute2"
    "openvpn"
)
depends:yum=(
    "python2"
    "python-setuptools"
    "python-crypto"
    "net-tools"
    "openvpn"
)
depends:apt=(
    "python"
    "net-tools"
    "iptables"
    "openvpn"
    "resolvconf"
)
makedepends:pacman=(
    "python2"
    "python2-setuptools"
    "python2-requests"
    "python2-crypto"
    "net-tools"
    "iproute2"
    "openvpn"
    "python2-distribute"
)
makedepends:yum=(
    "python-setuptools"
    "python-virtualenv"
)
makedepends:apt=(
    "python-dev"
    "python-setuptools"
    "python-virtualenv"
)
provides=("${pkgname}")
conflicts=(
    "pritunl-client"
    "pritunl-client-gtk"
)
sources=(
    "${url}/archive/${pkgver}.tar.gz"
)
hashsums=(
    "7b89add274314f9394fd75a484f90200b010fe1a0622d9e0483e57bf7a46d2d5"
)
backup=(
    "var/log/pritunl-client.log"
    "var/log/pritunl-client.log.1"
)

build:pacman() {
    cd "${srcdir}/pritunl-client-${pkgver}"
    python2 setup.py build
}
build:yum() {
    cd "${srcdir}/pritunl-client-${pkgver}"
    python setup.py build
    virtualenv /usr/lib/pritunl-client
    /usr/lib/pritunl-client/bin/pip install -r requirements.txt
}
build:apt() {
    cd "${srcdir}/pritunl-client-${pkgver}"
    python setup.py build
    virtualenv /usr/lib/pritunl-client
    /usr/lib/pritunl-client/bin/pip install -r requirements.txt
}

package:pacman() {
    cd "${srcdir}/pritunl-client-${pkgver}"
    mkdir -p "${pkgdir}/etc/pritunl_client"
    python2 setup.py install --root="${pkgdir}" --prefix=/usr --no-upstart --no-gtk
}
package:yum() {
    cd "${srcdir}/pritunl-client-${pkgver}"
    mkdir -p "${pkgdir}/usr/lib/pritunl-client"
    /usr/lib/pritunl-client/bin/python2 setup.py install --root="${pkgdir}" --no-gtk
    rm -r ${pkgdir}/etc/init.d
    mkdir -p ${pkgdir}/usr/bin
    ln -s /usr/lib/pritunl-client/bin/pritunl-client ${pkgdir}/usr/bin/pritunl-client
    cp -r /usr/lib/pritunl-client/* ${pkgdir}/usr/lib/pritunl-client/
}
package:debian() {
    cd "${srcdir}/pritunl-client-${pkgver}"
    mkdir -p "${pkgdir}/usr/lib/pritunl-client"
    /usr/lib/pritunl-client/bin/python setup.py install --root="${pkgdir}" --no-upstart --no-gtk
    mkdir -p ${pkgdir}/usr/bin
    ln -s /usr/lib/pritunl-client/bin/pritunl-client ${pkgdir}/usr/bin/pritunl-client
    cp -r /usr/lib/pritunl-client/* ${pkgdir}/usr/lib/pritunl-client/
}
package:ubuntu() {
    cd "${srcdir}/pritunl-client-${pkgver}"
    mkdir -p "${pkgdir}/usr/lib/pritunl-client"
    /usr/lib/pritunl-client/bin/python setup.py install --root="${pkgdir}" --no-upstart --no-gtk
    mkdir -p ${pkgdir}/usr/bin
    ln -s /usr/lib/pritunl-client/bin/pritunl-client ${pkgdir}/usr/bin/pritunl-client
    cp -r /usr/lib/pritunl-client/* ${pkgdir}/usr/lib/pritunl-client/
}
package:ubuntu-precise() {
    cd "${srcdir}/pritunl-client-${pkgver}"
    mkdir -p "${pkgdir}/usr/lib/pritunl-client"
    /usr/lib/pritunl-client/bin/python setup.py install --root="${pkgdir}" --no-systemd --no-gtk
    mkdir -p ${pkgdir}/usr/bin
    ln -s /usr/lib/pritunl-client/bin/pritunl-client ${pkgdir}/usr/bin/pritunl-client
    cp -r /usr/lib/pritunl-client/* ${pkgdir}/usr/lib/pritunl-client/
}
package:ubuntu-trusty() {
    cd "${srcdir}/pritunl-client-${pkgver}"
    mkdir -p "${pkgdir}/usr/lib/pritunl-client"
    /usr/lib/pritunl-client/bin/python setup.py install --root="${pkgdir}" --no-systemd --no-gtk
    mkdir -p ${pkgdir}/usr/bin
    ln -s /usr/lib/pritunl-client/bin/pritunl-client ${pkgdir}/usr/bin/pritunl-client
    cp -r /usr/lib/pritunl-client/* ${pkgdir}/usr/lib/pritunl-client/
}

postinst() {
    systemctl daemon-reload &> /dev/null || true
    systemctl restart pritunl-client &> /dev/null || true
    systemctl enable pritunl-client &> /dev/null || true
    service pritunl-client restart &> /dev/null || true
    restart pritunl-client &> /dev/null || true
}

prerm() {
    systemctl daemon-reload &> /dev/null || true
    systemctl stop pritunl-client &> /dev/null || true
    systemctl disable pritunl-client &> /dev/null || true
    service pritunl-client stop &> /dev/null || true
}

postrm() {
    rm -rf /etc/pritunl_client
}
